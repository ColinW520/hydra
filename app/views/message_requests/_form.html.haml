.row
  .col-sm-12
    %div.alert.alert-info
      %strong= "You're about to send a message to #{@expected_count} contacts."
    = simple_form_for [@message_request], authenticity_token: true, html: { id: 'MessageRequestForm' } do |f|
      .row
        .col-sm-12
          #error_holder
            %ul#errors
          = f.error_notification
          .form-group
            = f.input :line_id, label: 'From Line', as: :select, collection: current_user.organization.lines.active, label_method: :dropdown_name, value_method: :id, include_blank: false
          .form-group
            = f.input :body, label: 'Message Text', as: :text, required: true, autofocus: true, input_html: { class: 'form-control', id: "foobar" }
            #counter.pull-right Chachters: 0
            %br
          #warning.alert.alert-danger
            Hey, this really long. Are you sure this should be a text message? Wouldn't it be better to send this as an email this instead?
      .row
        .col-sm-12
          .form-actions
            .text-center
              = f.hidden_field :user_id, value: current_user.id
              = f.hidden_field :organization_id, value: current_user.organization_id
              = f.hidden_field :filter_query, value: @query.to_json
              = f.hidden_field :send_at, value: Time.now
              = f.button :submit, 'Send Message', class: 'btn btn-md btn-success'
              %br
              %br
              %small.text-danger
                By clicking this button, you accept applicable Twilio charges.
                %em Estimated Cost to Send this Message:
              #estimate{"data-original" => @expected_count}= number_to_currency @expected_count.to_f * 0.0075, precision: 4


:coffeescript
  $ ->
    $('#warning.alert.alert-danger').eq(1).hide()
    $('textarea').on 'keyup', ->
      length = $(this).val().length
      if length < 140
        $('#counter.pull-right').eq(1).html "<p class='text-success'>Charachters: " + length + "</p>"
        $('#warning.alert.alert-danger').eq(1).hide()
        estimate_value = $('div#estimate').eq(1).data("original") * 1 * 0.0075
        $('div#estimate').eq(1).html "<p class='lead text-success'>$" + estimate_value + "</p>"
      if length > 140 && length < 280
        $('#counter.pull-right').eq(1).html "<p class='lead text-danger'>Charachters: " + length + "</p>"
        $('#warning.alert.alert-danger').eq(1).hide()
        estimate_value = $('div#estimate').eq(1).data("original") * 2 * 0.0075
        $('div#estimate').eq(1).html "<p class='lead text-danger'>$" + estimate_value + "</p>"
      if length > 280 && length < 420
        $('#counter.pull-right').eq(1).html "<h3 class='text-danger'>Charachters: " + length + "</h3>"
        $('#warning.alert.alert-danger').eq(1).show()
        estimate_value = $('div#estimate').eq(1).data("original") * 3 * 0.0075
        $('div#estimate').eq(1).html "<p class='lead text-danger'>$" + estimate_value + "</p>"
      if length > 420
        $('div#estimate').eq(1).html "<p class='lead text-danger'>Unable to compute.</p>"
